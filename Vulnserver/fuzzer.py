#!/usr/bin/python
import sys, socket
from boofuzz import *

host = 'your ip'
port = 9999
def procmon(target, fuzz_data_logger, session, sock):
    global host
    port = 4444
    s=socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((host, port))
    data = s.recv(1)
    if data  == "1":
        print("[+] Crash Detected")
        print ("[+] Payload length: " + str(len(session.last_send)))
        print ("[+] Payload written to a file: payload.txt")
        f = open("payload.txt", "a")
        f.write(session.last_send)
        f.close()
        sys.exit(-1)
    s.close()
def main():
    f = open("payload.txt", "w")
    f.close()
    session = Session(post_test_case_callbacks=[procmon], target = Target(connection = SocketConnection(host, port, proto='tcp')))
    s_initialize("KSTET command")
    s_string("KSTET", fuzzable = False)
    s_delim(" ", fuzzable = False)
    s_string("TEST", fuzzable = True)
    session.connect(s_get("KSTET command"))
    session.fuzz()
if __name__ == "__main__":
    main()